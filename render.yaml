services:
  - type: web
    name: dha-back-office
    env: node
    plan: standard
    
    # Build configuration
    buildCommand: npm install
    startCommand: npm start
    
    # Environment variables - FIXED: using key/value only (no scope)
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "3000"
      - key: DOCUMENT_SIGNING_KEY
        value: dha-signing-key-2025
      - key: DOCUMENT_ENCRYPTION_KEY
        value: dha-encryption-key-2025
      - key: JWT_SECRET
        value: dha-jwt-secret-2025
      - key: SESSION_SECRET
        value: dha-session-secret-2025
      - key: DHA_NPR_API_KEY
        value: npr-api-key-production
      - key: DHA_DMS_API_KEY
        value: dms-api-key-production
      - key: DHA_VISA_API_KEY
        value: visa-api-key-production
      - key: DHA_MCS_API_KEY
        value: mcs-api-key-production
      - key: DHA_ABIS_API_KEY
        value: abis-api-key-production
      - key: HANIS_API_KEY
        value: hanis-api-key-production
    
    # Health check
    healthCheckPath: /api/health
    
    # Auto-deploy
    autoDeploy: true
    
    # Build configuration
    buildFilter:
      paths:
        - "server/**"
        - "attached_assets/**"
        - "package.json"
        - "package-lock.json"
